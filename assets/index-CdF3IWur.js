const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-CIS-KzjG.js","assets/openccConverter-CtI3b4IE.js","assets/llmConverter-JBKQxYT3.js"])))=>i.map(i=>d[i]);
(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function m(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=m(o);fetch(o.href,n)}})();const F="modulepreload",U=function(c){return"/"+c},S={},_=function(s,m,a){let o=Promise.resolve();if(m&&m.length>0){let d=function(i){return Promise.all(i.map(p=>Promise.resolve(p).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),f=e?.nonce||e?.getAttribute("nonce");o=d(m.map(i=>{if(i=U(i),i in S)return;S[i]=!0;const p=i.endsWith(".css"),b=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${b}`))return;const v=document.createElement("link");if(v.rel=p?"stylesheet":F,p||(v.as="script"),v.crossOrigin="",v.href=i,f&&v.setAttribute("nonce",f),document.head.appendChild(v),p)return new Promise((I,t)=>{v.addEventListener("load",I),v.addEventListener("error",()=>t(new Error(`Unable to preload CSS for ${i}`)))})}))}function n(d){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=d,window.dispatchEvent(e),!e.defaultPrevented)throw d}return o.then(d=>{for(const e of d||[])e.status==="rejected"&&n(e.reason);return s().catch(n)})},P="openai-config";function V(){if(typeof localStorage>"u")return{endpoint:"",token:""};const c=localStorage.getItem(P);if(c)try{return JSON.parse(c)}catch{}return{endpoint:"",token:""}}function W(c){typeof localStorage>"u"||localStorage.setItem(P,JSON.stringify(c))}function z(c="openai-config-area"){const s=document.createElement("div");s.innerHTML=`
    <details style="margin-bottom:16px;max-width:700px;margin-left:auto;margin-right:auto;">
      <summary style="font-size:1.1em;font-weight:bold;">OpenAI API 設定</summary>
      <div style="display:flex;flex-direction:column;gap:10px;padding:8px 0 0 0;align-items:center;justify-content:center;">
        <div style="display:flex;gap:16px;width:100%;max-width:650px;">
          <label style="flex:2 1 70%;min-width:320px;">Endpoint:<br><input id="openai-endpoint" style="width:100%;margin-top:2px"></label>
          <label style="flex:1 1 30%;min-width:120px;">Model:<br><input id="openai-model" style="width:100%;margin-top:2px" placeholder="gpt-3.5-turbo"></label>
        </div>
        <div style="display:flex;gap:16px;width:100%;max-width:650px;align-items:flex-end;">
          <label style="flex:1 1 100%;min-width:320px;">Token:<br><input id="openai-token" type="password" style="width:100%;margin-top:2px"></label>
          <label style="flex:1 1 100%;min-width:120px;">Token 上限:<br><input id="openai-token-limit" type="number" min="256" max="32768" step="1" style="width:100%;margin-top:2px" placeholder="16385"></label>
          <label style="flex:1 1 100%;min-width:120px;">併發請求數:<br><input id="openai-max-concurrent" type="number" min="1" max="32" step="1" style="width:100%;margin-top:2px" placeholder="12"></label>
          <div style="display:flex;flex-direction:column;align-items:flex-end;flex-shrink:0;position:relative;bottom:-8px;">
            <button id="save-openai-config" style="height:2.2em;min-width:72px;display:flex;align-items:center;justify-content:center;padding:0 18px;font-size:1em;">儲存</button>
            <span id="openai-config-status" style="margin-left:8px;color:#0a0;font-weight:bold;margin-top:2px;"></span>
          </div>
        </div>
      </div>
    </details>
  `,s.style.display="flex",s.style.justifyContent="center",s.style.width="100%",document.getElementById(c).appendChild(s);const m=document.getElementById("openai-endpoint"),a=document.getElementById("openai-token"),o=document.getElementById("openai-model"),n=document.getElementById("openai-config-status"),d=document.getElementById("openai-token-limit"),{endpoint:e,token:f,model:i}=V();m.value=e,a.value=f,o.value=i||"",d.value=localStorage.getItem("openaiTokenLimit")||"16385";const p=document.getElementById("openai-max-concurrent");p.value=localStorage.getItem("openaiMaxConcurrent")||"12",document.getElementById("save-openai-config").onclick=()=>{W({endpoint:m.value,token:a.value,model:o.value}),d.value&&!isNaN(Number(d.value))&&localStorage.setItem("openaiTokenLimit",d.value),p.value&&!isNaN(Number(p.value))&&localStorage.setItem("openaiMaxConcurrent",p.value),n.textContent="已儲存",setTimeout(()=>n.textContent="",1500)}}function q(c,s){c.innerHTML=`
    <div id="drop-area" style="border:2px dashed #bbb;padding:24px 12px;margin-bottom:12px;text-align:center;border-radius:8px;">
      <p style="margin:0 0 8px 0;">拖曳 .txt 檔案到此，或 <label style='color:#1976d2;cursor:pointer;text-decoration:underline;background:transparent;'><input type='file' id='file-input' accept='.txt' style='display:none;'>點擊選擇檔案</label></p>
      <div id="encoding-select-wrap" style="margin-bottom:8px; display:none;">
        <label for="encoding-select">編碼：</label>
        <select id="encoding-select" style="min-width:90px;">
          <option value="utf-8">UTF-8</option>
          <option value="gbk">GBK</option>
          <option value="gb18030">GB18030</option>
        </select>
      </div>
      <div id="file-preview" style="display:none;text-align:left;border-radius:6px;padding:8px 10px;margin-bottom:8px;max-height:180px;overflow:auto;font-size:0.98em;"></div>
    </div>
    <button id="convert">轉換</button>
    <div class="output" id="output" style="margin-top:18px;"></div>
  `;const m=document.getElementById("file-input"),a=document.getElementById("drop-area"),o=document.getElementById("file-preview"),n=document.getElementById("encoding-select"),d=document.getElementById("encoding-select-wrap");let e="";const f=document.createElement("div");f.id="llm-batch-estimate",f.style.color="#888",f.style.fontSize="0.98em",f.style.margin="4px 0 0 0",c.appendChild(f);async function i(t){const{containsAmbiguousChar:r}=await _(async()=>{const{containsAmbiguousChar:L}=await Promise.resolve().then(()=>A);return{containsAmbiguousChar:L}},void 0),{estimateTokens:u,getTokenLimit:g}=await _(async()=>{const{estimateTokens:L,getTokenLimit:C}=await import("./llmConverter-JBKQxYT3.js");return{estimateTokens:L,getTokenLimit:C}},[]),y=t.split(/\r?\n/),E=g();let x=0,l=0,h=0;for(const L of y){if(!L||!r(L))continue;const C=u(L);l+C>E&&x>0&&(h++,x=0,l=0),x++,l+=C}x>0&&h++,h>0?f.innerHTML=`預估 LLM batch 數：<b>${h}</b>`:f.innerHTML=""}function p(t){o.style.display="block",d.style.display="block";const r=t.split(/\r?\n/).slice(0,10);o.innerText=r.join(`
`)+(t.split(/\r?\n/).length>10?`
...（僅預覽前 10 行）`:""),o.style.whiteSpace="pre-line",i(t)}function b(){o.style.display="none",d.style.display="none"}function v(t,r,u){const g=new FileReader;g.onload=y=>{const E=y.target?.result;if(!E||!(E instanceof ArrayBuffer)){u("");return}try{const l=new TextDecoder(r).decode(new Uint8Array(E));u(l)}catch{u("")}},g.readAsArrayBuffer(t)}["dragenter","dragover"].forEach(t=>a.addEventListener(t,r=>{r.preventDefault(),a.style.background="#e3f2fd"})),["dragleave","drop"].forEach(t=>a.addEventListener(t,r=>{r.preventDefault(),a.style.background="unset"})),a.addEventListener("drop",t=>{const r=t.dataTransfer?.files;if(r&&r.length>0){const u=r[0],g=n.value;v(u,g,y=>{e=y,p(e),s(e),i(e)})}else b()}),m.addEventListener("change",()=>{const t=m.files;if(t&&t.length>0){const r=t[0],u=n.value;v(r,u,g=>{e=g,p(e),s(e),i(e)})}else b()}),n.addEventListener("change",()=>{let t=null;if(m.files&&m.files.length>0?t=m.files[0]:a._lastFile instanceof File&&(t=a._lastFile),t){const r=n.value;v(t,r,u=>{e=u,p(e),s(e),i(e)})}}),a.addEventListener("drop",t=>{const r=t.dataTransfer?.files;if(r&&r.length>0){a._lastFile=r[0];const u=r[0],g=n.value;v(u,g,y=>{e=y,p(e),s(e),i(e)})}}),m.addEventListener("change",()=>{const t=m.files;if(t&&t.length>0){a._lastFile=t[0];const r=t[0],u=n.value;v(r,u,g=>{e=g,p(e),s(e),i(e)})}});const I=document.getElementById("openai-token-limit");return I&&I.addEventListener("input",async()=>{const t=I.value,{containsAmbiguousChar:r}=await _(async()=>{const{containsAmbiguousChar:y}=await Promise.resolve().then(()=>A);return{containsAmbiguousChar:y}},void 0),{estimateTokens:u}=await _(async()=>{const{estimateTokens:y}=await import("./llmConverter-JBKQxYT3.js");return{estimateTokens:y}},[]),g=e.split(/\r?\n/);if(t&&!isNaN(Number(t))){let y=0,E=0,x=0;for(const l of g){if(!l||!r(l))continue;const h=u(l);E+h>Number(t)&&y>0&&(x++,y=0,E=0),y++,E+=h}y>0&&x++,x>0?f.innerHTML=`預估 LLM batch 數：<b>${x}</b>`:f.innerHTML=""}else i(e)}),{getFileContent:()=>e,setPreview:p}}const G={发:["發","髮"],干:["乾","幹","干"],后:["後","后"],面:["麵","面"],只:["只","隻"],空:["空","控"],差:["差","岔"],重:["重","種"],行:["行","航","型"],当:["當","挡"],系:["系","繫"],划:["劃","划"],兴:["興","兴"],松:["鬆","松"],蒙:["蒙","矇","懞"],征:["徵","征"],斗:["鬥","斗"],于:["於","于"],妆:["妝","粧"],呆:["呆","獃","待"],杰:["傑","杰"],虱:["蝨","虱"]};function O(c){return Object.keys(G).some(s=>c.includes(s))}const A=Object.freeze(Object.defineProperty({__proto__:null,containsAmbiguousChar:O},Symbol.toStringTag,{value:"Module"})),K=document.querySelector("#app");K.innerHTML=`
  <h1>智慧簡轉繁系統</h1>
  <div id="openai-config-area"></div>
  <div id="file-drop-area"></div>
`;z("openai-config-area");let B="";const J=document.getElementById("file-drop-area");q(J,c=>{B=c});_(async()=>{const{processText:c}=await import("./main-CIS-KzjG.js");return{processText:c}},__vite__mapDeps([0,1,2])).then(({processText:c})=>{document.getElementById("convert").onclick=async()=>{const s=document.getElementById("output");s.textContent="處理中...";const m=B||"";if(!m){s.textContent="請先拖曳或選擇檔案";return}const a=document.createElement("div");a.id="progress-info",a.style.margin="12px 0";const o=document.createElement("div");o.id="opencc-progress",o.textContent="OpenCC 進度：0/0";const n=document.createElement("div");n.id="llm-progress",n.textContent="LLM 進度：0/0",a.appendChild(o),a.appendChild(n),s.innerHTML="",s.appendChild(a);let d=0,e=0,f=0,i=0,p=!1;const b=m.split(/\r?\n/);i=b.filter(l=>l&&O(l)).length,e=b.filter(l=>l&&!O(l)).length,o.textContent=`OpenCC 進度：0/${e}`,n.textContent=`LLM 進度：0/${i}`;const{estimateTokens:v,getTokenLimit:I}=await _(async()=>{const{estimateTokens:l,getTokenLimit:h}=await import("./llmConverter-JBKQxYT3.js");return{estimateTokens:l,getTokenLimit:h}},[]),t=I();let r=0,u=0,g=0;for(const l of b){if(!l||!O(l))continue;const h=v(l);u+h>t&&r>0&&(g++,r=0,u=0),r++,u+=h}r>0&&g++,g>0&&(n.innerHTML+=`<br>預估 LLM batch 數：${g}`);const y=await _(()=>import("./llmConverter-JBKQxYT3.js"),[]),E=y.batchLLMConvert;async function x(l){await E(l)}window.onLLMBatchProgress=({current:l,total:h})=>{n.innerHTML=`LLM 進度：${f}/${i}<br>正在等待的 batch：${l}/${h}<br>正在等待 LLM 回覆...`};try{const l=await c(m,{onProgress:w=>{if(w.type==="opencc")d++,o.textContent=`OpenCC 進度：${d}/${e}`;else if(w.type==="llm"&&(f++,n.textContent=`LLM 進度：${f}/${i}`,f===i)){p=!0;const{getLastBatchStatus:k}=y,M=k();M?n.innerHTML=`LLM 進度：${i}/${i}<br>正在等待的 batch：${M.current}/${M.total}<br>正在等待 LLM 回覆...`:n.innerHTML=`LLM 進度：${i}/${i}<br>正在等待 LLM 回覆...`}},batchLLMConvert:x});(i===0||!p)&&(n.textContent=`LLM 進度：${f}/${i}`);let h="converted.txt",L;const C=document.getElementById("file-input");if(C&&C.files&&C.files[0])L=C.files[0];else{const w=document.getElementById("drop-area");w&&w._lastFile&&(L=w._lastFile)}if(L){const w=L.name,k=w.lastIndexOf("."),M=k>0?w.slice(0,k):w,R=k>0?w.slice(k):".txt",{convertWithOpenCC:H}=await _(async()=>{const{convertWithOpenCC:j}=await import("./openccConverter-CtI3b4IE.js");return{convertWithOpenCC:j}},[]);h=await H(M)+R}const $=l.replace(/\r?\n/g,`\r
`),N=new Blob([$],{type:"text/plain"}),D=URL.createObjectURL(N),T=document.createElement("a");T.href=D,T.download=h,T.textContent="下載轉換結果",T.style.display="inline-block",T.style.marginTop="12px",s.innerHTML="",s.appendChild(T)}catch(l){s.textContent="處理失敗："+(l instanceof Error?l.message:String(l))}}});export{O as c,V as g};
